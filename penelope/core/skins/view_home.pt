<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  i18n:domain="penelope"
      metal:use-macro="skin: /main_template">
<body>
  <div metal:fill-slot="body" tal:omit-tag="">

    <div class="span12"></div>

    <!-- kanban -->
    <div tal:condition="can_see_kanbanboards" tal:omit-tag="">
      <div class="span12">
        <h2>Favorite boards
          <a class="page-meta" href="${request.application_url}/admin/KanbanBoard">See all boards</a>
        </h2>
      </div>

      <div class="span12">
        <ul class="today-datas">
          <li class="bgreen" tal:repeat="kanbanboard kanbanboards">
            <div class="pull-left">
              <span class="spark">${','.join(kanbanboard.get_board_columns())}</span>
            </div>
            <div class="datas-text pull-right"><span class="bold"><a href="${request.application_url}/admin/KanbanBoard/${kanbanboard.id}">${kanbanboard.name}</a></span></div>
            <div class="clearfix"></div>
          </li>
          <li class="bred" tal:condition="not kanbanboards">
            <div class="pull-left">
                <i class="icon-plus-sign"></i>
            </div>
            <div class="datas-text pull-right"><span class="bold"><a href="${request.application_url}/admin/KanbanBoard/new">Add first board</a></span>
              seems you don't have any boards
            </div>
            <div class="clearfix"></div>
          </li>
        </ul>
      </div>
    </div>

    <!-- projects -->
    <div class="span12">
      <h2>Favorite projects
        <a class="page-meta" href="${request.application_url}/admin/Project">See all projects</a>
      </h2>
    </div>
    <div tal:repeat="project my_projects" class="span3">
      <div class="widget wlightblue" 
        tal:define="trac_apps list(project.tracs);
        customer project.customer;
        trac_uri trac_apps[0].api_uri if trac_apps else None" >
        <!-- Widget title -->
        <div class="widget-head">
          <div class="pull-left">
            <a href="${request.application_url}/admin/Project/${project.id}">${project.name}</a>
          </div>
          <div class="clearfix"></div>
        </div>
        <div class="widget-subhead">
          <div class="pull-left">
            <a href="${request.application_url}/admin/Customer/${customer.id}">${customer.name}</a>
          </div>
          <div class="clearfix"></div>
        </div>
        <div class="widget-foot" tal:condition="trac_uri">
          <span class="outstanding-tickets"
            data-trac-uri="${trac_uri}"><span>
              <a class="pull-right label" href="javascript:void(0)" data-toggle="collapse" data-target="#${project.id}-applications">Toggle apps</a>
            </div>
            <div class="widget-content">
              <div id="${project.id}-applications" class="collapse">
                <table class="table table-bordered"
                  tal:condition="applications"
                  tal:define="applications request.filter_viewables(project.applications)">
                  <tbody>
                    <tr tal:repeat="application applications">
                      <td tal:define="icon_html render_application_icon(request, application)">
                        <img src="" alt="" tal:replace="icon_html" tal:condition="icon_html">
                      </td>
                      <td>
                        <a href="${get_application_link(request, application)}">${application.name}</a>
                      </td>
                    </tr> 
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

  </div>

</body>
</html>
