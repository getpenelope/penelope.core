<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  i18n:domain="penelope"
      metal:use-macro="skin: /main_template">
<body>
  <div metal:fill-slot="body">

    <div tal:condition="kanbanboards">
      <div class="pull-right"><a href="${request.application_url}/admin/KanbanBoard" class="btn btn-small btn-primary">See all</a></div>
      <h3 i18n:translate="">Kanban boards</h3>
      <div class="projects-board">
        <div class="thumbnail"  tal:repeat="kanbanboard kanbanboards">
          <h3>
                <a href="${request.application_url}/admin/KanbanBoard/${kanbanboard.id}">${kanbanboard.name}</a>
          </h3>
          <p tal:repeat="column kanbanboard.get_board_columns()">
          ${column['name']}: <span class="badge ${column['tickets'] > 0 and 'badge-success' or ''}">${column['tickets']}</span>
          </p>
        </div>
      </div>
    </div>

    <tal:board repeat="dashboard dashboards">
      <div tal:condition="dashboard['custprojs']">
      <div class="pull-right"><a href="${request.application_url}/admin/Project" class="btn btn-small btn-primary">See all</a></div>
        <h3 i18n:translate="">${dashboard['title']}</h3>
        <div class="projects-board">
          <div tal:repeat="custprojs dashboard['custprojs']"
              class="thumbnail">
            <h3 tal:define="customer custprojs[0]">
              <a href="${request.application_url}/admin/Customer/${customer.id}">${customer.name}</a>
            </h3>
            <div tal:repeat="project custprojs[1]"
                class="boarded-project">
              <tal:trac-uri define="trac_apps list(project.tracs);
                                    trac_uri trac_apps[0].api_uri if trac_apps else None">
                <div class="btn-group"
                    tal:define="applications request.filter_viewables(project.applications)" >
                  <a href="${request.application_url}/admin/Project/${project.id}"
                    class="btn">${project.name}</a>
                  <button tal:condition="applications"
                          class="btn dropdown-toggle"
                          data-toggle="dropdown">
                    <span class="caret"></span>
                  </button>
                  <ul tal:condition="applications"
                      class="dropdown-menu">
                    <li tal:repeat="application applications">
                      <a tal:define="icon_html render_application_icon(request, application)"
                          href="${get_application_link(request, application)}">
                        <tal:icon condition="icon_html"
                                  replace="icon_html" />
                        ${application.name}
                      </a>
                    </li>
                  </ul>
                </div>
                <span tal:condition="trac_uri"
                      class="outstanding-tickets"
                      data-trac-uri="${trac_uri}"><span>
              </tal:trac-uri>
            </div>
          </div>
        </div>
      </div>
    </tal:board>



  </div>

</body>
</html>
