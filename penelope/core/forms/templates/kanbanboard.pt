<html metal:use-macro="main.macros['master']">
  <body metal:fill-slot="body">
    <div ng-app="kanban" ng-controller="KanbanCtrl">
        <div class="page-header">
            <div class="pull-right" tal:content="structure actions.buttons(request)"></div>
            <h3 tal:condition="request.model_name">
                 <span tal:condition="request.model_id and hasattr(request.model_class, '__unicode__')"
                       tal:replace="unicode(request.model_instance)"/>
                 <span tal:condition="request.model_id and not hasattr(request.model_class, '__unicode__')"
                       tal:replace="request.model_id"/>
                 <span tal:condition="not request.model_id"
                       tal:replace="unicode(request.model_class.label)"/>
            </h3>
        </div>

      <div class="row-fluid">
       <div class="span12">
         <ul class="kanban" ng-init="init('${request.model_instance.id}')">
               <li class="span3" ng-repeat="column in columns">
               <div class="thumbnail">
                     <div class="header_name">
                       <a class="btn btn-mini btn-danger pull-right" href="#" title="Remove column"
                          ng-click="removeColumn($index)"
                          ng-show="$index != 0">
                          <i class="icon-remove-sign icon-white"></i>
                        </a>
                        <a xeditable
                           data-ng-model="column.title"
                           href="#" data-type="text" data-title="Enter column name">{{column.title}}</a>
                      </div>
                      <div class="WIP {{column.tasks.length > column.wip && 'oversized'}}" ng-show="$index != 0">WIP: 
                        <a xeditable
                           data-ng-model="column.wip"
                           href="#" data-type="text" data-title="Enter column WIP">{{column.wip}}</a>
                       </div>

                       <ul class="task_pool" ui-sortable="sortableOptions" ng-model="column.tasks">
                         <li class="big_container {{task.priority && 'priority'}}" id="{{task.id}}" 
                                ng-repeat="task in column.tasks"
                                ng-model="columns[$parent.$index].tasks[$index]"
                                ng-show="task.id">
                             <div class="box_itm">
                               <div class="number pull-right">#{{task.ticket}}</div>
                               <span class="project" style="{{getColor($parent.$index, $index)}}" title="{{task.customer}}">{{task.project}}</span>
                               <span class="ticket"><a target="_blank" href="{{task.url}}">{{task.summary}}</a></span>
                            </div>
                          </li>
                   </ul>
                 </div>
              </li>
            </ul>
        </div>
        </div>
        </div>
  </body>
</html>

